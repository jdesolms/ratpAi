!function(t,e){tC.tagPerfE=1,(0===tC.tagPerfE&&0==Math.floor(1e3*Math.random())||1===tC.tagPerfE)&&tC.containersLaunched&&(t.tC.tagPerfAnalyzer=new function(n,r){var a=tC.tagPerf?tC.tagPerf.pagePatterns:tC.tagPatterns,s=("http:"==e.location.protocol?"http:":"https:")+"//engage.commander1.com/tagsperf",o=[],c={};for(var f in this.tags={},tC.tagPerf&&(a=a.concat(tC.tagPerf.customPatterns)),this.concatPatterns=function(){var t=[];for(var e in a)a[e].hasOwnProperty("p")&&t.push(a[e].p);return t.join("|")},this.getPageMetrics=function(){var e,a=n.performance.timing.navigationStart;return function(){if("msFirstPaint"in n.performance.timing)e=n.performance.timing.msFirstPaint-a;else if(t.performance.getEntriesByType("paint").length>0)e=t.performance.getEntriesByType("paint")[0].startTime;else if("chrome"in n&&"loadTimes"in n.chrome){var i=n.chrome.loadTimes();if("firstPaintTime"in i&&i.firstPaintTime>0){var s=i.startLoadTime;"requestTime"in i&&(s=i.requestTime),i.firstPaintTime>=s&&(e=1e3*(i.firstPaintTime-s))}}if(void 0===e||e<0||e>12e4){e=n.performance.timing.responseStart-a;for(var o={},c=r.getElementsByTagName("head")[0].children,f=0;f<c.length;f++){var d=c[f];"SCRIPT"==d.tagName&&d.src&&!d.async&&(o[d.src]=!0),"LINK"==d.tagName&&"stylesheet"==d.rel&&d.href&&(o[d.href]=!0)}for(var g=n.performance.getEntriesByType("resource"),h=!1,m=0;m<g.length;m++)if(h||!o[g[m].name]||"script"!=g[m].initiatorType&&"link"!=g[m].initiatorType)h=!0;else{var p=g[m].responseEnd;(void 0===e||p>e)&&(e=p)}}e=Math.max(e,0)}(),{dr:Math.round(n.performance.timing.domContentLoadedEventEnd-a),fp:Math.round(e),dl:Math.round(n.performance.timing.loadEventEnd-a)}},tC.containersLaunched)o.push(f);this.processPage=function(){this.fullRegex=new RegExp(this.concatPatterns(),"i");var t={};if(!(0>=(c=this.getPageMetrics()).dl||c.dl>32e3||0>=c.dr||c.dr>32e3||0>=c.fp||c.fp>32e3)){for(var e in tC.containersLaunched)for(var r in tC.containersLaunched[e])for(var a in tC.containersLaunched[e][r].t)t[e+"_"+r+"_"+tC.containersLaunched[e][r].t[a].id]=1;for(var i=n.performance.getEntriesByType("resource"),f=i.length;f--;)this.processTag(i[f],t);var d={s:o.join("|"),dr:Math.min(c.dr,32e3),dl:Math.min(c.dl,32e3),fp:Math.min(c.fp,32e3),ev:tC.tagPerf.env_template||tc_vars.env_template||"default",tg:encodeURIComponent(JSON.stringify(this.tags))};if("custom_segment"in n.tc_vars&&(d.cs=n.tc_vars.custom_segment),navigator&&"sendBeacon"in navigator)navigator.sendBeacon(s,JSON.stringify(d));else{var g=Object.keys(d).map(function(t){return t+"="+d[t]}).join("&"),h=s+"?"+g;h.length<1500&&((new Image).src=h)}}},this.processTag=function(t,e){if(!(t.duration<0)){var n=t.name,r=function(t){var e=0;for(i=0;i<t.length;i++)char=t.charCodeAt(i),e=(e<<5)-e+char,e&=e;return Math.abs(e)};if(this.fullRegex.test(n))for(var s=0;s<a.length;s++)if(new RegExp(a[s].p,"i").test(n)){var o,f,d,g;if(f=d="",a[s].id?(o=a[s].id,f=a[s].sid,d=a[s].cid,a[s].label?(g=a[s].label,id_tpl=0):id_tpl=a[s].idt):a[s].label&&(o="999"+r(g=a[s].label),a[s].id_site&&a[s].id_container&&(f=a[s].id_site,d=a[s].id_container)),void 0===g&&void 0===e[f+"_"+d+"_"+o])continue;var h="t"+f+"_"+d+"_"+o;return h in this.tags||(this.tags["t"+f+"_"+d+"_"+o]={id:o,c:d,s:f,bdr:0,bfp:0,bdl:0,t:0},void 0!==g&&(this.tags[h].lb=g)),t.startTime<c.dr&&(this.tags[h].bdr+=Math.min(Math.round(t.duration),32e3)),t.startTime<c.fp&&(this.tags[h].bfp+=Math.min(Math.round(t.duration),32e3)),t.startTime<c.dl&&(this.tags[h].bdl+=Math.min(Math.round(t.duration),32e3)),this.tags[h].t+=Math.min(Math.round(t.duration),32e3),!0}return!1}},n.performance&&n.performance.getEntriesByType&&setTimeout(function(t){t.processPage()},2e3,this)}(t,e))}(window,document);
